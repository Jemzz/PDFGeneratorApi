<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:sl="http://www.nlog-project.org/schemas/NLog.Targets.Syslog.xsd"
      autoReload="true"
      internalLogLevel="Debug"
      internalLogFile="logs\internal-nlog.txt">

  <!-- enable asp.net core layout renderers -->
  <extensions>
    <add assembly="NLog.Web.AspNetCore"/>
    <add assembly="NLog.Targets.Syslog" />
  </extensions>

  <!-- the targets to write to -->
  <targets async="true">

    <target type="file" name="appfile" filename="${environment:HOME:cached=true}/logfiles/application/app-${shortdate}-${processid}.txt" />
    <target xsi:type="Console" name="console" layout="${longdate} ${uppercase:${level}} ${message}" />

    <!--<target name="consoleerror" xsi:type="Console" layout="${longdate} ${uppercase:${level}} ${exception}" />-->

    <target xsi:type="sl:Syslog" name="syslogPaperTrail" >
      <sl:layout xsi:type="SimpleLayout" text="[wxlpdf@56587 ${all-event-properties:format=[key]=&quot;[value]&quot;:separator= :includeCallerInformation=False}] ${message} ${exception:format=ToString,StackTrace,Data}" />
      <sl:enforcement>
        <sl:splitOnNewLine>false</sl:splitOnNewLine>
        <sl:transliterate>false</sl:transliterate>
        <sl:replaceInvalidCharacters>false</sl:replaceInvalidCharacters>
        <sl:truncateFieldsToMaxLength>true</sl:truncateFieldsToMaxLength>
        <sl:truncateMessageTo>1024</sl:truncateMessageTo>
      </sl:enforcement>
      <sl:messageCreation>
        <sl:facility>Local4</sl:facility>
        <sl:rfc>Rfc5424</sl:rfc>
        <sl:rfc5424>
          <sl:hostname xsi:type="SimpleLayout" text="${gdc:item=sender}" />
          <sl:appName xsi:type="SimpleLayout" text="${event-properties:item=userid}" />
          <sl:procId xsi:type="SimpleLayout" text="${processid}" />
          <sl:msgId xsi:type="SimpleLayout" text="${threadid}" />
          <sl:disableBom>true</sl:disableBom>
        </sl:rfc5424>
      </sl:messageCreation>
      <sl:messageSend>
        <sl:protocol>TCP</sl:protocol>
        <sl:tcp>
          <sl:server>logs4.papertrailapp.com</sl:server>
          <sl:port>34874</sl:port>
          <sl:tls>
            <sl:enabled>true</sl:enabled>
          </sl:tls>
        </sl:tcp>
      </sl:messageSend>
    </target>
  </targets>
  <!-- ****** Paper trail connection config is managed in app.settings under section loggingoptions. This is loaded into program.cs at runtime. -->


  <!-- rules to map from logger name to target -->
  <rules>
    <!--All logs, including from Microsoft-->
    <logger ruleName="filterMicrosoftLogs" name="Microsoft.*" finalMinLevel="Warn" maxlevel="Info" final="true" />

    <logger name="*" minlevel="Trace" writeTo="console" />
    <logger name="*" minLevel="Debug" writeTo="appFile" />
    <logger name="*" minlevel="Debug" writeTo="syslogPaperTrail"/>
    <!-- BlackHole without writeTo -->
  </rules>
</nlog>